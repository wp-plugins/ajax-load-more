/*
 * WordPress Ajax Load More
 * http://wordpress.org/plugins/ajax-load-more/
 * https://github.com/dcooney/wordpress-ajax-load-more
 *
 * Copyright 2014 Connekt Media - http://connekthq.com
 * Free to use under the GPLv2 license.
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * Author: Darren Cooney
 * Twitter: @KaptonKaos
*/

(function(e){"use strict";e.ajaxloadmore=function(t){var n={},r=0,i=300,s=false,o=true,u=true,a=false,f=e(window),l="",c,h=t,p=e(".alm-listing",h),d=true,v="alm-",m=p.data("repeater"),g=p.data("max-pages"),y=p.data("pause"),b=p.data("offset"),w=p.data("transition"),E=p.data("posts-per-page");e(window).scrollTop(0);if(y===undefined){y=false}if(m===undefined){m="default"}if(g===undefined){g=5}if(g==="none"){g=1e6}if(w===undefined){w="slide"}else if(w==="fade"){w="fade"}else{w="slide"}if(p.data("offset")===undefined){b=0}else{b=p.data("offset")}if(p.data("button-label")===undefined){l="Older Posts"}else{l=p.data("button-label")}if(p.data("scroll")===undefined){d=true}else if(p.data("scroll")===false){d=false}else{d=true}var S=p.data("post-type");S=S.split(",");h.append('<div class="'+v+'btn-wrap"><button id="load-more" class="'+v+'load-more-btn more">'+l+"</button></div>");var x=e(".alm-load-more-btn",h);n.loadPosts=function(){x.addClass("loading");u=true;e.ajax({type:"GET",url:alm_localize.ajaxurl,data:{action:"ajax_load_more_init",nonce:alm_localize.alm_nonce,repeater:m,postType:S,postFormat:p.data("post-format"),category:p.data("category"),author:p.data("author"),taxonomy:p.data("taxonomy"),taxonomy_terms:p.data("taxonomy-terms"),taxonomy_operator:p.data("taxonomy-operator"),tag:p.data("tag"),order:p.data("order"),orderby:p.data("orderby"),search:p.data("search"),exclude:p.data("exclude"),numPosts:p.data("posts-per-page"),pageNumber:r,offset:b},dataType:"html",beforeSend:function(){if(r!=1){x.addClass("loading")}},success:function(t){c=e(t);if(o){x.text(l);o=false}if(c.length>0){var n=e('<div class="'+v+'reveal"/>');n.append(c);n.hide();p.append(n);if(w==="fade"){n.fadeIn(i,"alm_easeInOutQuad",function(){u=false;x.delay(i).removeClass("loading");if(c.length<E){a=true;x.addClass("done")}})}else{n.slideDown(i,"alm_easeInOutQuad",function(){u=false;x.delay(i).removeClass("loading");if(c.length<E){a=true;x.addClass("done")}})}}else{x.delay(i).removeClass("loading").addClass("done");u=false;a=true}},error:function(e,t,n){u=false;x.removeClass("loading")}})};x.on("click",function(){if(y===true){y=false;n.loadPosts()}if(!u&&!a&&!e(this).hasClass("done")){u=true;r++;n.loadPosts()}});n.isVisible=function(){var e=false;if(h.is(":visible")){e=true}return e};if(d){f.bind("scroll touchstart",function(){if(n.isVisible()){var e=x.offset();if(!u&&!a&&f.scrollTop()>=Math.round(e.top-(f.height()-150))&&r<g-1&&s){u=true;r++;n.loadPosts()}}})}if(y===true){x.text(l);u=false}else{n.loadPosts()}setTimeout(function(){s=true},1e3);e.easing.alm_easeInOutQuad=function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t+n;return-r/2*(--t*(t-2)-1)+n}};e.fn.ajaxloadmore=function(){return this.each(function(){e.ajaxloadmore(e(this))})};if(e(".ajax-load-more-wrap").length)e(".ajax-load-more-wrap").ajaxloadmore()})(jQuery)